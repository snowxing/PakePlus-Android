import{d as v,l as C,w as D,c as O,a as y,b as k,B as S,r as d,g as T,h as p,_ as U,m as b,aq as F,p as L,x as j,z as q,e as h}from"./index-5kp1FiRg.js";import J from"./detail-ew4YeckH.js";import{r as M,a as P}from"./improve-DL5FWc6v.js";import{u as z}from"./useTabsListener-CnvSNM1v.js";import"./Detail-CBGWh8FM.js";/* empty css                                                               */const E=v({__name:"ReportListSearchForm",props:{form:{}},emits:["update:form"],setup(_,{emit:r}){const s=_,m=r,u=C({...s.form});return D(u,l=>{m("update:form",l)},{deep:!0}),(l,o)=>{const f=S;return y(),O(f,{modelValue:k(u).date,"onUpdate:modelValue":o[0]||(o[0]=c=>k(u).date=c),label:"年度",placeholder:"请选择年度",format:"YYYY"},null,8,["modelValue"])}}}),I=v({__name:"ReportList",setup(_){async function r({pageNum:a,form:e}){const n={};e.date&&(n.start_date=e.date,n.end_date=Number(e.date)+1);const i=await M({page:a,...n});return{total:Number(i.count),data:i.data}}const s=[{title:"报表名称",key:"title",width:"60%",align:"center"},{title:"报表时间",key:"updated_at",width:"30%",render:a=>L(a).format("YYYY-MM-DD")}],m=d(!1),u=d([]);function l(a){return a?JSON.parse(a):{}}function o(a,e){return a.map(n=>"\n        ".concat(n.name,": ").concat(e[n.key]||0,"\n      "))}function f(a){m.value=!0,P({id:a.id}).then(e=>{const n=e.dangerous?JSON.parse(e.dangerous):{},i="\n      较大风险数量：".concat(n.count,"\n      同比变化：").concat(n.percent,"\n    "),t=l(e.risk),g=l(e.accident),x=o([{key:"count",name:"事故数"},{key:"die_count",name:"死亡人数"},{key:"hert_count",name:"受伤人数"},{key:"die_percent",name:"事故下降"},{key:"hert_percent",name:"死亡下降"},{key:"count_percent",name:"受伤下降"}],g),w=l(e.emergency),Y=o([{key:"name",name:"名称"},{key:"time",name:"演练时间"},{key:"num",name:"参加人数"},{key:"note",name:"备注"}],w),$=l(e.train),B=o([{key:"name",name:"名称"},{key:"time",name:"培训时间"},{key:"num",name:"参加人数"},{key:"note",name:"备注"}],$),N=o([{key:"title",name:"区域"},{key:"percent",name:"排查率"}],t.department),R=o([{key:"title",name:"区域"},{key:"num",name:"数量"}],t.department),V=o([{key:"title",name:"区域"},{key:"num",name:"数量"}],t.area);u.value=[{label:"报告名称",value:e.title},{label:"时间区间",value:e.time_range},{label:"风险情况",value:i,renderType:"list"},{label:"各责任部门风险情况",value:e.larmRules},{label:"各区域风险情况",value:e.alarmVal},{label:"各部门风险排查率",value:e.alarmTime},{label:"较大隐患数量",value:t==null?void 0:t.count},{label:"同比变化",value:t.percent},{label:"部门隐患发现情况",value:V,renderType:"list"},{label:"区域隐患发现情况",value:R,renderType:"list"},{label:"部门隐患冶理率",value:N,renderType:"list"},{label:"教育培训",value:B,renderType:"list"},{label:"应急演练",value:Y,renderType:"list"},{label:"事故情况",value:x,renderType:"list"},{label:"情况总结",value:e.result},{label:"存在问题",value:e.issue},{label:"工作建议",value:e.advice}]})}const c=d({date:""});return(a,e)=>{const n=U,i=F;return y(),T("div",null,[p(n,{form:c.value,"onUpdate:form":e[1]||(e[1]=t=>c.value=t),columns:s,request:r,floating:[{icon:"search",key:"search"}],onOnRowClick:f},{searchForm:b(()=>[p(E,{form:c.value,"onUpdate:form":e[0]||(e[0]=t=>c.value=t)},null,8,["form"])]),_:1},8,["form"]),p(i,{show:m.value,"onUpdate:show":e[2]||(e[2]=t=>m.value=t),position:"bottom",style:{height:"70%"}},{default:b(()=>[p(J,{items:u.value},null,8,["items"])]),_:1},8,["show"])])}}}),A={class:"flex-center h-[100vh] w-100% items-center"},G=v({__name:"index",setup(_){const r=d("");return z("improveReport-click-tab",s=>{r.value=s.name}),(s,m)=>(y(),T("div",A,[j(p(I,null,null,512),[[q,r.value==="1"]])]))}});typeof h=="function"&&h(G);export{G as default};
