import{aB as U,d as v,j as k,r as f,l as S,w as B,o as N,g as R,a as y,h as _,b as s,G as P,U as T,F as $,k as C,c as b,m as h,au as w,i as j,ad as L,_ as M,M as D,aD as x,aE as O,e as V}from"./index-5kp1FiRg.js";import{u as q}from"./useTabsListener-CnvSNM1v.js";import{c as F}from"./config-BiPkORWZ.js";import{a as E}from"./index-BpTLWCN6.js";async function A(c){return U.get("/ensafe/turn_list",{params:c})}const G=v({__name:"SearchForm",props:{form:{default:()=>({})},dataKey:{default:{year:"implement_year",obj_id:"obj_id"}}},emits:["update:form"],setup(c,{emit:d}){var n;(n=k())==null||n.userInfo;const u=c,i=d,o=f(F.get("duty_status").map(t=>({text:t.name,value:t.id}))),l=f([]),a=S({...u.form});B(a,t=>{i("update:form",t)},{deep:!0});const p=async()=>{const t=await E({id:"106"});l.value=(t||[]).map(e=>({text:e.title,value:e.node_id}))};return N(()=>{p()}),(t,e)=>{const r=P,g=T;return y(),R($,null,[_(r,{modelValue:s(a).name,"onUpdate:modelValue":e[0]||(e[0]=m=>s(a).name=m),placeholder:"请输入值班名称"},null,8,["modelValue"]),_(g,{modelValue:s(a).type,"onUpdate:modelValue":e[1]||(e[1]=m=>s(a).type=m),columns:l.value,placeholder:"请选择值班类型"},null,8,["modelValue","columns"]),_(g,{modelValue:s(a).status,"onUpdate:modelValue":e[2]||(e[2]=m=>s(a).status=m),columns:o.value,placeholder:"请选择值班状态"},null,8,["modelValue","columns"])],64)}}}),I={class:"text-12px"},K=v({__name:"DutyRecord",setup(c){const{routerPush:d}=C(),u=k(),i=[{icon:"search",key:"search"}],o=f({name:"",type:"",status:""}),l=[{title:"值班名称",key:"name",width:"50%"},{title:"值班类型",key:"type",width:"25%"},{title:"值班状态",key:"status",width:"25%"}];async function a({pageNum:n}={pageNum:1}){const t={page:n,...o.value},e=await A(t);return{total:Number(e==null?void 0:e.count)||0,data:(e==null?void 0:e.data)||[]}}function p(n){u.getPri("duty-record",1)?d("task-process",{appid:3,transid:n.process_inst_id,task_id:n.id}):D("暂无权限")}return(n,t)=>{const e=M;return y(),b(e,{form:s(o),"onUpdate:form":t[1]||(t[1]=r=>w(o)?o.value=r:null),columns:l,floating:i,request:a,onOnRowClick:p},{"cell-status":h(({row:r})=>[j("div",I,L(s(F).trans("duty_status",r.status)),1)]),searchForm:h(()=>[_(G,{form:s(o),"onUpdate:form":t[0]||(t[0]=r=>w(o)?o.value=r:null)},null,8,["form"])]),_:1},8,["form"])}}}),z={class:"flex-center h-[100vh] w-100% items-center"},H=v({__name:"index",setup(c){const d=k(),u=f("dutyRecord"),{routerPush:i}=C();q("duty-tab",a=>{u.value=a.name});const o=x(()=>({dutyRecord:K})),l=x(()=>{if(u.value==="dutyRecord")return o.value.dutyRecord;if(d.getPri("duty-record",1))i("task-process",{app_id:3,task_id:0});else return D("暂无权限"),o.value.dutyRecord;return null});return(a,p)=>(y(),R("div",z,[(y(),b(O(l.value)))]))}});typeof V=="function"&&V(H);export{H as default};
