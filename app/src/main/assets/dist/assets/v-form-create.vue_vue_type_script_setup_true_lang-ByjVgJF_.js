import{d as B,r as F,w as E,c as N,a as R,b as P,bg as z}from"./index-5kp1FiRg.js";const K={input:"field",textarea:"field",select:"select",radio:"radio",checkbox:"checkbox",datePicker:"datetime-picker",timePicker:"datetime-picker",date:"v-datetime-picker",switch:"switch",slider:"slider",hidden:"hidden",cascader:"v-cascader",static:"v-group-button",treeselect:"v-treeselect",inputselect:"v-inputselect",label:"v-label"},$=["row","col","divider","card","tabs","tab-pane"],q=["col","style","class","control"];function m(t){const o={};for(const a in t){const e=t[a];if(e!=null)if(typeof e=="object"&&!Array.isArray(e)){const r=m(e);Object.keys(r).length&&(o[a]=r)}else o[a]=e}return o}function G(t,o={},a={}){var r,s,y,x,u,d,g,l,n,c,i,p,b,v;const e={...o};switch(t){case"label":return{...a,props:e};case"input":return e.readonly&&a.validate&&!a.value&&(a.validate=(r=a.validate)==null?void 0:r.map(f=>f.required?{...f,required:!1}:f)),{...a,placeholder:e.placeholder||a.placeholder||"请输入",readonly:(s=e.readonly)!=null?s:!1,disabled:(y=e.disabled)!=null?y:!1};case"textarea":{const f=t==="textarea",h={placeholder:e.placeholder,clearable:(x=e.clearable)!=null?x:!0};return f&&(h.type="textarea",h.rows=(u=e.rows)!=null?u:3),m({...e,...h})}case"select":{const f=((d=a.options)==null?void 0:d.map(h=>{var k;return{...h,text:(k=h.label)!=null?k:h.text,value:String(h.value)}}))||[];return a.value&&(a.value=String(a.value)),m({...e,columns:f,options:f,columnsFieldNames:{text:"label",value:"value"},disabled:(g=e.disabled)!=null?g:e.readonly,props:{...e}})}case"switch":return m({activeValue:(l=e.activeValue)!=null?l:!0,inactiveValue:(n=e.inactiveValue)!=null?n:!1,...e});case"date":case"datePicker":case"timePicker":return m({...e,type:(c=e.type)!=null?c:"datetime",format:(i=e.format)!=null?i:"yyyy-MM-dd HH:mm:ss",placeholder:(p=e.placeholder)!=null?p:"请选择时间"});case"upload":{const f=JSON.parse(JSON.stringify(e)),{max:h,maxSize:k,disabled:C,readonly:T,..._}=f,A=a.props||{},M=".jpg,.jpeg,.png,.doc,.docx,.pdf,.xls,.xlsx,.zip,.rar,.7z,.ppt,.pptx,.txt",O=(b=a.title)==null?void 0:b.includes("附件");let S=A.accept;S||(S=O?(A==null?void 0:A.format)||M:"image/*");let w=A.action;return w||(w=O?"/api/uploader/doc":"/api/uploader/image"),{..._,disabled:C||T,action:w,accept:S,onSuccess:"$FNX:const res = $inject.args[0];\nconst file = $inject.args[1];\n\nfile.url = res.data.url;"}}case"cascader":return{...a,options:e.data||[],multiple:!0,...e,disabled:(v=e.disabled)!=null?v:e.readonly};default:return m(e)}}function H(t,o){return(t==null?void 0:t.source)==="staff"&&o.type==="treeselect"?(t.dataType="treeselect","v-inputselect"):null}function I(t){var r;const o=K[t.type]||t.type,a=G(t.type,t.props,t),e={...t,type:H(a,t)||o,props:a};for(const s of q)s in e&&delete e[s];return t.type==="select"&&(delete e.options,((r=t==null?void 0:t.props)==null?void 0:r.multiple)===!1&&(e.value=Array.isArray(t.value)?t.value[0]:t.value)),t.type==="treeselect"&&Array.isArray(t.options)&&(e.props={...e.props||{},options:t.options.map(s=>({...s}))}),m(e)}function j(t,o){var e,r;const a=[];for(const s of t)if(!$.includes(s.type))if(s.type==="dynamic"&&Array.isArray(s.row)){const y=[],x=j(s.row[0]);y.push(...x);const u={},d={};for(const l of s.row)for(const n of l)if(n.type==="treeselect"&&Array.isArray(n.options)){const c=n.field||((e=n.props)==null?void 0:e.field);if(!c)continue;const i=n.options.map(p=>{var b,v;return{label:(b=p.label)!=null?b:p.text,text:(v=p.label)!=null?v:p.text,value:String(p.value)}});u[c]=[...u[c]||[],...i],n.ref&&(d[n.ref]=[...d[n.ref]||[],...i])}if(Object.keys(u).length)for(const l of y){const n=l.field||((r=l.props)==null?void 0:r.field);if(!n)continue;const c=u[n];if(l.type==="v-treeselect"&&Array.isArray(c)){const i=new Set,p=[];for(const b of c){const v=String(b.value);i.has(v)||(i.add(v),p.push({...b,value:v}))}l.props={...l.props||{},options:p,instanceOptionsMap:d}}}const g=[];for(const l of s.row){const n=j(l),c={};n.forEach(i=>{c[i.field]=i.value}),g.push(c)}a.push({...s,props:{min:1,max:10,rule:y,disabled:o},value:s.value||g||[{}],type:"group"})}else a.push(I(s));return a}const D=B({__name:"v-form-create",props:{json:{type:[Object,Array],default:()=>[]},ruleKey:{type:String,default:"inputs"},convert:{type:Function,default:()=>null},renderContainer:{type:Function,default:()=>null},expand:{type:Boolean,default:!0}},setup(t){const o=t,a=F([]);E(()=>o.json,r=>{let s=r[o.ruleKey],y=!1;Array.isArray(r)?s=r:y=r.readonly;const x=j(s,y),u=o.convert(r);let d=u?[...u,...x]:x;Array.isArray(r)||(d=[{type:"v-collapse",children:d,vm:["v-collapse"],props:{title:o.renderContainer(r)||r.title,expand:o.expand}}]),a.value=d},{immediate:!0});const e={submitBtn:{show:!1},resetBtn:{show:!1}};return(r,s)=>(R(),N(P(z),{rule:P(a),option:e},null,8,["rule"]))}});export{D as _};
