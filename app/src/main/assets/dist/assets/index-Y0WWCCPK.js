import{u as j}from"./useTabsListener-CnvSNM1v.js";import{aB as w,d as g,j as P,l as q,r as m,w as O,o as k,g as x,a as v,h as p,B as I,G as J,F as U,k as F,c as T,m as b,au as S,b as y,i as h,ad as C,_ as V,H as G,J as Y,aC as L,D,C as R,s as H,aj as N,t as W,v as M,aD as B,aE as Z,e as A}from"./index-5kp1FiRg.js";import{c as z}from"./config-BiPkORWZ.js";import{_ as K}from"./HazardListSearchForm.vue_vue_type_script_setup_true_lang--1PMZZa9.js";import"./index-1VOhhtK2.js";import{e as $}from"./install-CoVyZzHx.js";import"./install-8Xh6dgN5.js";import"./install-BO7C1UUT.js";import"./install-DOWDe9Pp.js";import"./createSeriesDataSimply-BFEE_GIw.js";import"./install-QPGF1BwB.js";import"./install-neqUmNW9.js";async function Q(i){return w.get("/ensafe/risk_record_list",{params:i})}async function X(i){return w.get("/enbase/risk_delay_list",{params:i})}async function ee(i){return w.get("/statistics/risk_source_department",{params:i})}async function te(i){return w.get("/statistics/risk_source_area",{params:i})}async function ae(i){return w.get("/statistics/risk",{params:i})}async function le(i){return w.get("/ensafe/get_danger_count",{params:i})}const se=g({__name:"DeferredSearchForm",props:{form:{default:{}}},emits:["update:form"],setup(i,{emit:r}){const e=i,_=r;P();const o=q({...e.form});return m([]),m([]),m({label:"title",value:"node_id",children:"child"}),O(()=>o,s=>{_("update:form",s)},{deep:!0}),O(()=>e.form,s=>{Object.assign(o,s)},{deep:!0,immediate:!0}),k(()=>{}),(s,a)=>{const c=I,l=J;return v(),x(U,null,[p(c,{"model-value":o.year,format:"YYYY",placeholder:"请选择年度","onUpdate:modelValue":a[0]||(a[0]=t=>t&&(o.year=t))},null,8,["model-value"]),p(l,{modelValue:o.change_hazard,"onUpdate:modelValue":a[1]||(a[1]=t=>o.change_hazard=t),type:"text",name:"text",label:"",placeholder:"请输入变更隐患"},null,8,["modelValue"])],64)}}}),oe={class:"text-12px"},ne=g({__name:"DeferredLedger",setup(i){const r=P(),{routerPush:e}=F(),_=[{icon:"search",key:"search"}],o=[{title:"延期时间",className:"three",key:"date_1",uname:"",width:100,type:"selection"},{title:"变更原因",className:"three",key:"input_3",uname:"",type:"selection"},{title:"变更隐患",className:"three",key:"desc",width:"20%",uname:"",type:"selection"}],s=[{status:0,name:"退回"},{status:1,name:"确认"},{status:2,name:"待审核"}],a=m({page:1,page_size:30,year:"",change_hazard:""});async function c({pageNum:t}){const n={page:t||1,...a.value},u=await X(n);return{total:Number((u==null?void 0:u.count)||0)||0,data:(u==null?void 0:u.data)||[]}}function l(t){const{eid:n}=r.userInfo,u=new RegExp(n,"g"),f=[{label:"原纳期时间",value:t.date_2},{label:"延期时间",value:t.date_1},{label:"申请人",value:t.uid_user_name},{label:"申请人工号",value:t.uid_account.replace(u,"")},{label:"批准人",value:t.check_uid_user_name},{label:"批准人工号",value:t.check_uid_account.replace(u,"")},{label:"备注",value:t.input_1}];e("doublePreventionDetail",{detail:JSON.stringify(f)})}return(t,n)=>{const u=V;return v(),T(u,{form:y(a),"onUpdate:form":n[1]||(n[1]=f=>S(a)?a.value=f:null),columns:o,request:c,floating:_,onOnRowClick:l},{"cell-radio_6":b(({row:f})=>{var d;return[h("div",oe,C(((d=s.find(E=>E.status===f.radio_6))==null?void 0:d.name)||""),1)]}),searchForm:b(()=>[p(se,{form:y(a),"onUpdate:form":n[0]||(n[0]=f=>S(a)?a.value=f:null)},null,8,["form"])]),_:1},8,["form"])}}}),re={class:"text-12px"},ie={class:"text-12px"},ce={class:"flex items-center"},ue=g({__name:"HazardList",setup(i){const{routerPush:r}=F(),e=[{title:"检查时间",className:"three",key:"find_time",uname:"",width:"28%",type:"selection"},{title:"隐患描述",className:"three",key:"desc",uname:"",width:"30%",editable:!1,searchable:!1},{title:"隐患级别",key:"level",width:"25%"},{title:"状态",key:"status",width:"20%"},{title:"来源",className:"three",key:"sources",uname:"",width:100,editable:!1,searchable:!1}],_=[{value:10,label:"5S"},{value:11,label:"脚手搭设"},{value:12,label:"个人防护"},{value:13,label:"动能皮带"},{value:14,label:"脚手点检"},{value:15,label:"脚手定置"},{value:16,label:"定置管理"},{value:17,label:"安全用电"},{value:18,label:"管线架空"},{value:19,label:"设备设施"},{value:20,label:"作业安全"},{value:21,label:"设备点检"},{value:22,label:"安全监护"},{value:23,label:"私搭私拆"},{value:24,label:"目视管理"},{value:25,label:"作业审批"},{value:26,label:"通风照明"},{value:27,label:"脚手材料"},{value:28,label:"消防管理"},{value:29,label:"违章吸烟"},{value:30,label:"火灾"},{value:31,label:"皮带出舱"},{value:32,label:"攀爬脚手"},{value:33,label:"环保"},{value:34,label:"高空抛物"},{value:35,label:"其他"},{value:36,label:"设备保护"},{value:37,label:"跑冒滴漏"}],o=[{icon:"search",key:"search"}],s=m({page:1,inspect_name:"",sort:"zh",inspect_type:0,status:-1,level:"",set_etp_id:"",start_date:"",end_date:""});async function a({pageNum:t}={pageNum:1}){const n={...s.value,page:t},u=await Q(n);return{total:Number(u.count)||0,data:u.data||[]}}function c(t){r("task-process",{task_id:0,tid:t.process_inst_id,viewtask:!0})}function l(t){var f;let n=z.trans("zhenggai_status",t.status);t.status==0&&t.sign=="1"&&(n="超纳期");const u=[{label:"位置",value:t.place},{label:"隐患级别",value:z.trans("hidden_level_list",t.level)},{label:"隐患描述",value:t.desc},{label:"整改要求及措施",value:t.fix_policy},{label:"责任部门",value:t.fixman_uid_department_id_depart_name},{label:"状态",value:n},{label:"隐患类别",value:((f=_.find(d=>d.value===t.risk_value))==null?void 0:f.label)||""},{label:"责任人",value:t.fixman_uid_user_name},{label:"整改纳期",value:t.need_fix_time},{label:"资金投入",value:t.money},{label:"整改验收人",value:t.fixman},{label:"发现地点",value:t.place},{label:"发现时间",value:t.find_time},{label:"整改前图片",value:t.before_image,renderType:"image"},{label:"整改后图片",value:t.after_image,renderType:"image"}];r("doublePreventionDetail",{detail:JSON.stringify(u)})}return(t,n)=>{const u=G,f=V;return v(),T(f,{columns:e,request:a,form:y(s),"onUpdate:form":n[1]||(n[1]=d=>S(s)?s.value=d:null),floating:o,onOnRowClick:l},{"cell-level":b(({row:d})=>[h("div",re,C(y(z).trans("hidden_level_list",d.level)),1)]),"cell-status":b(({row:d})=>[h("div",ie,C(d.status==="0"&&d.sign==="1"?"超纳期":y(z).trans("zhenggai_status",d.status)),1)]),"cell-sources":b(({row:d})=>[h("div",ce,[p(u,{disabled:!d.process_inst_id||d.process_inst_id==="0",type:"primary",size:"mini",onClick:E=>c(d)},{default:b(()=>[...n[2]||(n[2]=[Y(" 来源 ",-1)])]),_:1},8,["disabled","onClick"])])]),searchForm:b(()=>[p(K,{form:y(s),"onUpdate:form":n[0]||(n[0]=d=>S(s)?s.value=d:null)},null,8,["form"])]),_:1},8,["form"])}}}),de=g({__name:"bepartmentHiddenDanger",setup(i){const r=m(null);let e=null;async function _(){H({message:"加载中...",forbidClick:!0});const s={set_etp_id:"@",level:"0",accident_type:"0",department_id:"0",season:""};try{const a=await ee(s);a.forEach(l=>{l.name=l.title}),await N(),e&&e.dispose(),e=$(r.value);const c={title:{text:"部门隐患数量统计",show:!1},tooltip:{show:!0,trigger:"item",formatter:"{b} : {c} ({d}%)",backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:"#eee",borderWidth:1,textStyle:{color:"#333"}},legend:{left:0,bottom:0,itemWidth:10,itemHeight:10,textStyle:{fontSize:12}},series:[{type:"pie",radius:["40%","60%"],center:["50%","40%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:4,borderColor:"#fff",borderWidth:2},label:{show:!0,position:"outside",formatter:" {c} ({d}%)",fontSize:12,color:"#333",alignTo:"edge",edgeDistance:10,rich:{b:{fontWeight:"bold",lineHeight:22}}},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"}},labelLine:{show:!0},data:a}],color:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc","#4cabce"]};e.setOption(c)}catch(a){console.error("加载部门隐患数量统计失败",a)}finally{W()}}function o(){e&&e.resize()}return k(()=>{_(),window.addEventListener("resize",o)}),L(()=>{e&&(e.dispose(),e=null),window.removeEventListener("resize",o)}),(s,a)=>{const c=R,l=D;return v(),x("div",null,[p(l,{class:"mb-2"},{default:b(()=>[p(c,{title:"部门隐患数量统计",class:"!p-0","title-class":"text-white text-center bg-[#032e6d] py-2 font-semibold text-[15px]",border:!1})]),_:1}),h("div",{id:"chartContainer",ref_key:"chartContainerRef",ref:r,class:"my-30px px-16px h-[250px] w-100%"},null,512)])}}}),pe=g({__name:"RegionalHazards",setup(i){const r=m(null);let e=null;const _=async()=>{H({message:"加载中...",forbidClick:!0});const s={set_etp_id:"@",level:"0",accident_type:"0",department_id:"0",season:""};try{const a=await te(s);a.forEach(l=>{l.name=l.title,l.value=Number(l.value)}),await N(),e&&e.dispose(),e=$(r.value);const c={title:{text:"区域隐患数量统计",show:!1},tooltip:{show:!0,trigger:"item",formatter:"{b} : {c} ({d}%)",backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:"#eee",borderWidth:1,textStyle:{color:"#333"}},legend:{left:0,bottom:-20,itemWidth:10,itemHeight:10,textStyle:{fontSize:12}},series:[{type:"pie",radius:["40%","60%"],center:["50%","40%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:4,borderColor:"#fff",borderWidth:2},label:{show:!0,position:"outside",formatter:"{c} ({d}%)",fontSize:12,color:"#333",alignTo:"edge",edgeDistance:10,rich:{b:{fontWeight:"bold",lineHeight:22}}},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"}},labelLine:{show:!0,length:10,length2:10,smooth:!0},data:a}],color:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc","#4cabce"]};e.setOption(c)}catch(a){console.error("加载区域隐患数量统计失败",a)}finally{W()}},o=()=>{e&&e.resize()};return k(()=>{_(),window.addEventListener("resize",o)}),L(()=>{e&&(e.dispose(),e=null),window.removeEventListener("resize",o)}),(s,a)=>{const c=R,l=D;return v(),x("div",null,[p(l,{class:"mb-2"},{default:b(()=>[p(c,{title:"区域隐患数量统计",class:"!p-0","title-class":"text-white text-center bg-[#032e6d] py-2 font-semibold text-[15px]",border:!1})]),_:1}),h("div",{ref_key:"chartContainerRef",ref:r,id:"chartContainer",class:"w-100% h-[250px] px-16px mb-30px"},null,512)])}}}),_e=g({__name:"HazardClassification",setup(i){const r=m(null);let e=null;async function _(){H({message:"加载中...",forbidClick:!0});const s={set_etp_id:"@",level:"0",season:""};try{const c=(await ae(s)).map(t=>({name:t.title,value:Number(t.value)}));await N(),e&&e.dispose(),e=$(r.value);const l={title:{text:"隐患分类统计",show:!1},tooltip:{show:!0,trigger:"item",formatter:"{b} : {c} ({d}%)",backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:"#eee",borderWidth:1,textStyle:{color:"#333"}},legend:{type:"scroll",orient:"horizontal",left:"center",bottom:0,itemWidth:10,itemHeight:10,textStyle:{fontSize:12},pageButtonPosition:"end",pageTextStyle:{color:"#333"},formatter:t=>t.length>12?"".concat(t.substring(0,12),"..."):t},grid:{containLabel:!0},series:[{type:"pie",radius:["40%","55%"],center:["50%","40%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:4,borderColor:"#fff",borderWidth:2},label:{show:!0,position:"outside",formatter:"{c} ({d}%)",fontSize:12,color:"#333",alignTo:"edge",edgeDistance:10,rich:{b:{fontWeight:"bold",lineHeight:22}}},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"}},labelLine:{show:!0,length:10,length2:10,smooth:!0},data:c}],color:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc","#4cabce"]};e.setOption(l)}catch(a){console.error("加载隐患分类统计失败",a)}finally{W()}}function o(){e&&e.resize()}return k(()=>{_(),window.addEventListener("resize",o)}),L(()=>{e&&(e.dispose(),e=null),window.removeEventListener("resize",o)}),(s,a)=>{const c=R,l=D;return v(),x("div",null,[p(l,{class:"mb-2"},{default:b(()=>[p(c,{title:"隐患分类统计",class:"!p-0","title-class":"text-white text-center bg-[#032e6d] py-2 font-semibold text-[15px]",border:!1})]),_:1}),h("div",{id:"chartContainer",ref_key:"chartContainerRef",ref:r,class:"mb-30px px-16px h-[350px] w-100%"},null,512)])}}}),fe={class:"text-12px mb-2 px-4 text-right"},me={class:"ml-4"},be=g({__name:"HazardStatisticalAnalysis",setup(i){const r=m(null);let e=null;const _=m(0),o=m(0);async function s(){H({message:"加载中...",forbidClick:!0});const c={set_etp_id:"@"};try{const l=await le(c);_.value=l.year_total||0,o.value=l.deal_total||0;const t=l.header||[],n=l.data||[];await N(),e&&e.dispose(),e=$(r.value);const u={title:{text:"隐患统计分析",show:!1},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{type:"scroll",orient:"horizontal",left:"center",bottom:0,itemWidth:10,itemHeight:10,textStyle:{fontSize:12}},grid:{left:"3%",right:"4%",bottom:"60px",top:"3%",containLabel:!0},xAxis:{type:"category",data:t,axisLabel:{interval:0,rotate:30,fontSize:12}},yAxis:{type:"value",splitLine:{lineStyle:{type:"dashed"}}},series:n.map(f=>({name:f.name,type:"line",data:f.data,smooth:!0,symbol:"circle",symbolSize:6,label:{show:!0,position:"top",fontSize:12},emphasis:{focus:"series"}})),color:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc","#4cabce"],dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],start:0,end:5}]};e.setOption(u)}catch(l){console.error("加载隐患统计分析失败",l)}finally{W()}}function a(){e&&e.resize()}return k(()=>{s(),window.addEventListener("resize",a)}),L(()=>{e&&(e.dispose(),e=null),window.removeEventListener("resize",a)}),(c,l)=>{const t=R,n=D;return v(),x("div",null,[p(n,{class:"mb-2"},{default:b(()=>[p(t,{title:"隐患统计分析",class:"!p-0","title-class":"text-white text-center bg-[#032e6d] py-2 font-semibold text-[15px]",border:!1})]),_:1}),h("div",fe,[Y(" 本年累计数："+C(y(_))+" ",1),h("span",me,"整改累计数："+C(y(o)),1)]),h("div",{id:"chartContainer",ref_key:"chartContainerRef",ref:r,class:"mb-30px px-16px h-[350px] w-100%"},null,512)])}}}),he=M(be,[["__scopeId","data-v-e72db613"]]),ve=g({__name:"HazardStats",setup(i){return(r,e)=>(v(),x(U,null,[p(de),p(pe),p(_e),p(he)],64))}}),ge={class:"flex-center h-[100vh] w-100% items-center"},ye=g({__name:"index",setup(i){const r=m("basic");j("hazardList-tab",o=>{r.value=o.name});const e=B(()=>({HazardList:ue,DeferredLedger:ne,HazardStats:ve})),_=B(()=>e.value[r.value]||null);return(o,s)=>(v(),x("div",ge,[(v(),T(Z(_.value)))]))}});typeof A=="function"&&A(ye);export{ye as default};
