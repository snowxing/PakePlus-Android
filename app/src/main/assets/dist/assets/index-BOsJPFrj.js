import{d as Z,j as ee,r as d,f as se,o as ae,g as o,a as t,h as r,i as a,a8 as ne,a9 as te,m as D,J as V,H as oe,I as R,F as A,E as T,aa as ie,ab as le,ac as ce,G as de,ad as w,ae as m,c as G,y as L,af as re,ag as ue,p as S,ah as ve,ai as pe,aj as fe,v as ge,e as U}from"./index-5kp1FiRg.js";const _e={class:"chat-page"},me={key:0,class:"chat-content"},ye={class:"ai-message"},he={class:"avatar"},ke={class:"message-content"},be={class:"message-buttons"},Ie={class:"guess-you-ask"},Ce={class:"guess-header"},we={class:"guess-list"},xe=["onClick"],Me={key:0,class:"loading-container"},De=["innerHTML"],Ve={key:2},Ae={class:"dialogue-tips"},Te={class:"chat-bottom-nav"},He={class:"nav-scroll"},Ne=["onClick"],Ye={class:"nav-icon"},Be={class:"nav-text"},Re={class:"chat-input"},Ge={class:"input-container"},Le={class:"field-container"},Se={class:"input-buttons"},j=Z({__name:"index",setup(Ue){const u=ee(),h=d(null),k=se(),H=d(""),p=d(""),N=d(!0),b=d("1"),E=d([{text:"问数据",value:"1"},{text:"问法规",value:"2"}]),Y=d(["我是工贸企业，要做哪些安全管理制度？","有限空间作业要办哪些票证、流程、防护？","电气/设备常见隐患有哪些？怎么自查整改？"]),F=["我是工贸企业，要做哪些安全管理制度？","有限空间作业要办哪些票证、流程、防护？","电气/设备常见隐患有哪些？怎么自查整改？","危化品企业需要哪些安全管理制度和台账？","重大危险源怎么辨识、分级、建档、报备？","危化品泄漏、火灾、中毒应急处置步骤怎么做？","双重预防机制怎么建、资料怎么做？","发生事故/隐患，怎么上报、调查、闭环？","安全员日常要做哪些工作，不背锅、不违规？"];function Q(){const s=[...F].sort(()=>.5-Math.random());Y.value=s.slice(0,3)}function $(s){p.value=s,M()}function x(s){return s.startsWith("/")?new URL("".concat(s),window.location.origin).href:new URL(s,import.meta.url).href}function z(s){b.value=s}function K(){k.push({name:"chatPageVideo"})}function q(){k.push({name:"orderService"})}function J(s){k.push({name:s.url})}const W=d([{id:0,name:"智能体",icon:"iconyinhuanqingdan",url:"agentPerson"},{id:1,name:"隐患上报",icon:"iconshangbao1",url:"hazardReporting"},{id:2,name:"作业申请",icon:"iconyinhuanpaichajihua",url:"workRequest"},{id:3,name:"全部应用",icon:"iconxiangmuguanli",url:"/home/"}]),g=d([]),y=d(!1);async function M(){if(y.value==!0){ue("数据正在生成中请稍后...");return}if(!p.value.trim())return;p.value&&(N.value=!1);const s={id:Date.now(),type:"user",content:p.value.trim(),time:S(new Date).format("YYYY-MM-DD HH:mm:ss")};g.value.push(s);const n=p.value.trim();p.value="";const v={id:Date.now()+1,type:"ai",content:"",displayContent:"",typingIndex:0,loading:!0,time:S(new Date).format("YYYY-MM-DD HH:mm:ss")};g.value.push(v);try{let i;b.value==="1"?(y.value=!0,i=await ve({answer:n})):(y.value=!0,i=await pe({content:n})),O(v.id,i)}catch(i){console.error("Error getting AI answer:",i);const f=g.value.find(l=>l.id===v.id);f&&(f.loading=!1,f.content='<div style="color: #ff4d4f;">抱歉，获取AI回答失败，请重试</div>')}}function O(s,n){const v=g.value.find(l=>l.id===s&&l.type==="ai");if(!v)return;v.displayContent=n,v.typingIndex=0;const i=5,f=100;setTimeout(()=>{const l=g.value.find(_=>_.id===s&&_.type==="ai");if(l){l.loading=!1;const _=setInterval(()=>{const c=g.value.find(C=>C.id===s&&C.type==="ai");if(!c){clearInterval(_),y.value=!1;return}if(c.typingIndex>=c.displayContent.length){clearInterval(_),y.value=!1;return}const I=Math.min(c.typingIndex+i,c.displayContent.length);c.typingIndex=I,c.content=c.displayContent.slice(0,I),P()},f)}else console.log("Current message not found:",s)},100)}function P(){fe(()=>{h.value&&(h.value.scrollTop=h.value.scrollHeight)})}function X(){var s;(s=u==null?void 0:u.userInfo)!=null&&s.etp_id_name||k.push({name:"login"})}return ae(()=>{var s,n;H.value=(s=u==null?void 0:u.userInfo)!=null&&s.etp_id_name?(n=u==null?void 0:u.userInfo)==null?void 0:n.etp_id_name:"未登陆，请登录"}),(s,n)=>{const v=ne,i=te,f=oe,l=R,_=R,c=ie,I=le,C=de;return t(),o("div",_e,[r(v,{title:H.value,class:"nav-bar",onClick:X},null,8,["title"]),N.value?(t(),o("div",me,[a("div",ye,[a("div",he,[r(i,{src:x("/static/common/images/ai/person.png"),round:"",class:"img"},null,8,["src"]),n[2]||(n[2]=a("div",{class:"message-text"},[a("p",{class:"greeting"}," 你好 "),a("p",{class:"recommendation"}," 您好！我是您的AI安全助手，为您推荐我的AI安全生产管理服务，可以帮您完成 “风险、隐患、作业” 所有安全事务 ")],-1))]),a("div",ke,[a("div",be,[r(f,{type:"default",class:"btn-learn",onClick:K},{default:D(()=>[...n[3]||(n[3]=[V(" 了解DeepSafety ",-1)])]),_:1}),r(f,{type:"warning",class:"btn-order",onClick:q},{default:D(()=>[...n[4]||(n[4]=[V(" 订购 ",-1)])]),_:1})])])]),a("div",Ie,[a("div",Ce,[n[6]||(n[6]=a("h3",{class:"guess-title"}," 猜你想问 ",-1)),a("div",{class:"refresh-btn",onClick:Q},[r(l,{name:"replay"}),n[5]||(n[5]=V(" 换一换 ",-1))])]),a("div",we,[(t(!0),o(A,null,T(Y.value,(e,B)=>(t(),o("div",{key:B,class:"guess-item",onClick:je=>$(e)},w(e),9,xe))),128))])])])):(t(),o("div",{key:1,ref_key:"chatMessagesRef",ref:h,class:"chat-content-message"},[(t(!0),o(A,null,T(g.value,e=>(t(),o("div",{key:e.id||e.time,class:m(["dialogue-item",e.type==="user"?"user-dialogue":"ai-dialogue"])},[a("div",{class:m(["dialogue-avatar",e.type==="user"?"user-avatar":"ai-avatar"])},[e.type==="user"?(t(),G(i,{key:0,src:x("/static/common/images/ai/man.png"),round:"",class:"h-40 w-40"},null,8,["src"])):(t(),G(i,{key:1,src:x("/static/common/images/ai/ai.png"),round:"",class:"h-40 w-40"},null,8,["src"]))],2),a("div",{class:m(["dialogue-content",e.type==="user"?"user-content":"ai-content"])},[a("div",{class:m(["dialogue-bubble",e.type==="user"?"user-bubble":"ai-bubble"])},[e.type==="ai"&&e.loading?(t(),o("div",Me,[...n[7]||(n[7]=[re('<div class="colorful-loader" data-v-7ffbd240><div class="loader-dot" data-v-7ffbd240></div><div class="loader-dot" data-v-7ffbd240></div><div class="loader-dot" data-v-7ffbd240></div><div class="loader-dot" data-v-7ffbd240></div><div class="loader-dot" data-v-7ffbd240></div></div><div class="loading-text" data-v-7ffbd240> AI 正在思考... </div>',2)])])):e.type==="ai"?(t(),o("div",{key:1,innerHTML:e.content},null,8,De)):e.type==="user"?(t(),o("div",Ve,w(e.content),1)):L("",!0),a("div",Ae,[a("span",{class:m({"dialogue-time-ai":e.type==="ai","dialogue-time-user":e.type==="user"})},w(e.time),3),e.type==="ai"?(t(),o("span",{key:0,class:m({"dialogue-tips-ai":e.type==="ai","dialogue-tips-user":e.type==="user"})},"此内容由AI生成",2)):L("",!0)])],2)],2)],2))),128))],512)),a("div",Te,[a("div",He,[(t(!0),o(A,null,T(W.value,e=>(t(),o("div",{key:e.id,class:"nav-item",onClick:B=>J(e)},[a("div",Ye,[r(_,{"class-prefix":e.icon,class:"iconfont menu-icon",name:"extra"},null,8,["class-prefix"])]),a("span",Be,w(e.name),1)],8,Ne))),128))])]),a("div",Re,[a("div",Ge,[r(I,{class:"ai-type-selector",style:{"background-color":"transparent !important"},background:"transparent",direction:"up"},{default:D(()=>[r(c,{modelValue:b.value,"onUpdate:modelValue":n[0]||(n[0]=e=>b.value=e),options:E.value,onChange:z},null,8,["modelValue","options"])]),_:1}),a("div",Le,[r(C,{modelValue:p.value,"onUpdate:modelValue":n[1]||(n[1]=e=>p.value=e),placeholder:"发消息...",class:"input-field",onKeyup:ce(M,["enter"])},null,8,["modelValue"])]),a("div",Se,[r(l,{name:"guide-o",class:"guide-btn",onClick:M})])])])])}}});typeof U=="function"&&U(j);const Fe=ge(j,[["__scopeId","data-v-7ffbd240"]]);export{Fe as default};
