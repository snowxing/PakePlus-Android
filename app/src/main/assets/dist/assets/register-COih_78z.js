import{d as E,f as R,j,r as v,l as k,aD as F,a6 as G,g as z,a as H,h as l,m as p,i as u,G as J,b as s,H as L,J as T,ad as Q,a2 as A,a_ as K,au as q,aq as W,bc as r,bf as X,bs as Y,bt as Z,e as C}from"./index-5kp1FiRg.js";import{_ as ee}from"./v-uploader.vue_vue_type_script_setup_true_lang-C6PQErmB.js";const oe={class:"m-x-a text-center w-7xl",style:{padding:"20px 0"}},se={class:"mt-16 rounded-3xl overflow-hidden"},ne={class:"mt-16 rounded-3xl overflow-hidden"},te={class:"mt-16 rounded-3xl overflow-hidden"},le={class:"mt-16 rounded-3xl overflow-hidden"},ae={class:"mt-16 rounded-3xl overflow-hidden"},re={class:"mt-16 rounded-3xl overflow-hidden"},ie={class:"mt-16 rounded-3xl overflow-hidden"},ue={class:"mt-32"},de=E({__name:"register",setup(me){const V=R(),d=j(),x=v(!1),c=v(!1),y=v(!1),o=k({userType:"",company_name:"",company_license:[],company_industry:"",name:"",mobile:"",code:""}),h=v(null),$=[{text:"企业用户",value:"1",disabled:!1},{text:"安全专家",value:"2",disabled:!0}],I=[{text:"化工",value:1},{text:"工贸",value:2}],m=k({userType:[{required:!0,message:"请选择用户类型"}],company_name:[{required:!0,message:"请输入公司名称"}],company_industry:[{required:!0,message:"请选择行业"}],name:[{required:!0,message:"请输入姓名"}],mobile:[{required:!0,message:"请输入手机号"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号"}],code:[{required:!0,message:"请输入验证码"}]});function N(t){o.company_industry=t.selectedOptions[0].text,h.value=t.selectedOptions[0].value,c.value=!1}function P(t){o.userType=t.selectedOptions[0].text,y.value=!1}async function O(){console.log(o.company_license);const t=d.getEidUser();try{x.value=!0;const e={user_type:o.userType,company_name:o.company_name,company_license:o.company_license.length>0?o.company_license.join(","):"",company_industry:Number(h.value),name:o.name,mobile:o.mobile,code:o.code,eid:t.eid},a=await Y(e);if(console.log(a),a.status==1){r({type:"success",message:"注册成功"});try{const i=await Z({mobile:o.mobile});d.setInfo(i),d.setToken(i.token),await d.setMenus(),d.activeOnlineTimer();let{redirect:_,...w}=V.currentRoute.value.query;_==="404"&&(_="chatPage"),V.push({name:_||"chatPage",query:{...w}})}catch(i){throw d.clearToken(),r(i),i}}else r({type:"danger",message:a.message||"注册失败"})}catch(e){r({type:"danger",message:e.message||"注册失败"})}finally{x.value=!1}}const g=v(!1),f=v(0);let b=null;const S=F(()=>f.value>0?"".concat(f.value,"秒后重新获取"):g.value?"获取中...":"获取验证码");async function M(){if(!o.mobile){r({type:"warning",message:"请输入手机号"});return}if(!/^1[3-9]\d{9}$/.test(o.mobile)){r({type:"warning",message:"请输入正确的手机号"});return}g.value=!0;try{const t=await X({type:1,mobile:Number(o.mobile)});t==1?(r({type:"success",message:"验证码已发送"}),B()):r({type:"danger",message:t.message||"获取验证码失败"})}catch(t){r({type:"danger",message:t.message||"获取验证码失败"})}finally{g.value=!1}}function B(){f.value=120,b=setInterval(()=>{f.value--,f.value<=0&&clearInterval(b)},1e3)}function D(t){console.log(t),o.company_license=t}return G(()=>{d.setEidUser({}),b&&clearInterval(b)}),(t,e)=>{const a=J,i=L,_=A,w=K,U=W;return H(),z("div",oe,[l(_,{model:s(o),rules:s(m),"validate-trigger":"onSubmit",onSubmit:O},{default:p(()=>[u("div",se,[l(a,{modelValue:s(o).userType,"onUpdate:modelValue":e[0]||(e[0]=n=>s(o).userType=n),rules:s(m).userType,required:"",name:"userType",label:"用户类型","is-link":"",readonly:"",placeholder:"请选择用户类型",onClick:e[1]||(e[1]=n=>y.value=!0)},null,8,["modelValue","rules"])]),u("div",ne,[l(a,{modelValue:s(o).company_name,"onUpdate:modelValue":e[2]||(e[2]=n=>s(o).company_name=n),modelModifiers:{trim:!0},required:"",rules:s(m).company_name,name:"company_name",label:"公司名称",placeholder:"请输入公司名称"},null,8,["modelValue","rules"])]),u("div",te,[l(a,{name:"company_license",label:"营业执照"},{input:p(()=>[l(ee,{value:s(o).company_license,"onUpdate:value":[e[3]||(e[3]=n=>s(o).company_license=n),D]},null,8,["value"])]),_:1})]),u("div",le,[l(a,{modelValue:s(o).company_industry,"onUpdate:modelValue":e[4]||(e[4]=n=>s(o).company_industry=n),rules:s(m).company_industry,required:"",name:"company_industry",label:"行业","is-link":"",readonly:"",placeholder:"请选择行业",onClick:e[5]||(e[5]=n=>c.value=!0)},null,8,["modelValue","rules"])]),u("div",ae,[l(a,{modelValue:s(o).name,"onUpdate:modelValue":e[6]||(e[6]=n=>s(o).name=n),modelModifiers:{trim:!0},rules:s(m).name,required:"",name:"name",label:"姓名",placeholder:"请输入姓名"},null,8,["modelValue","rules"])]),u("div",re,[l(a,{modelValue:s(o).mobile,"onUpdate:modelValue":e[7]||(e[7]=n=>s(o).mobile=n),modelModifiers:{trim:!0},rules:s(m).mobile,required:"",name:"mobile",label:"手机号",type:"tel",maxlength:"11",placeholder:"请输入手机号"},null,8,["modelValue","rules"])]),u("div",ie,[l(a,{modelValue:s(o).code,"onUpdate:modelValue":e[8]||(e[8]=n=>s(o).code=n),modelModifiers:{trim:!0},rules:s(m).code,required:"",name:"code",label:"验证码",placeholder:"请输入验证码"},{button:p(()=>[l(i,{size:"small",type:"primary",plain:"",disabled:s(f)>0||s(g),onClick:M},{default:p(()=>[T(Q(s(S)),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue","rules"])]),u("div",ue,[l(i,{loading:s(x),type:"primary","native-type":"submit",round:"",block:""},{default:p(()=>[...e[13]||(e[13]=[T(" 注册 ",-1)])]),_:1},8,["loading"])])]),_:1},8,["model","rules"]),l(U,{show:s(c),"onUpdate:show":e[10]||(e[10]=n=>q(c)?c.value=n:null),position:"bottom"},{default:p(()=>[l(w,{columns:I,onConfirm:N,onCancel:e[9]||(e[9]=n=>c.value=!1)})]),_:1},8,["show"]),l(U,{show:s(y),"onUpdate:show":e[12]||(e[12]=n=>q(y)?y.value=n:null),position:"bottom"},{default:p(()=>[l(w,{columns:$,onConfirm:P,onCancel:e[11]||(e[11]=n=>y.value=!1)})]),_:1},8,["show"])])}}});typeof C=="function"&&C(de);export{de as default};
