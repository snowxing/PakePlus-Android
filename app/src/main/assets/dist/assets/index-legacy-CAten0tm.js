System.register(["./index-legacy-CK9unWWd.js"],function(e,a){"use strict";var n,t,i,s,l,o,c,d,u,r,v,p,m,f,g,y,h,b,k,I,x,w,C,_,D,M,H,Y,V,A,R,j,L;return{setters:[e=>{n=e.d,t=e.j,i=e.r,s=e.f,l=e.o,o=e.g,c=e.a,d=e.h,u=e.i,r=e.a8,v=e.a9,p=e.m,m=e.J,f=e.H,g=e.I,y=e.F,h=e.E,b=e.aa,k=e.ab,I=e.ac,x=e.G,w=e.ad,C=e.ae,_=e.c,D=e.y,M=e.af,H=e.ag,Y=e.p,V=e.ah,A=e.ai,R=e.aj,j=e.v,L=e.e}],execute:function(){const T={class:"chat-page"},U={key:0,class:"chat-content"},S={class:"ai-message"},q={class:"avatar"},E={class:"message-content"},P={class:"message-buttons"},z={class:"guess-you-ask"},F={class:"guess-header"},G={class:"guess-list"},J=["onClick"],K={key:0,class:"loading-container"},W=["innerHTML"],$={key:2},B={class:"dialogue-tips"},N={class:"chat-bottom-nav"},O={class:"nav-scroll"},Q=["onClick"],X={class:"nav-icon"},Z={class:"nav-text"},ee={class:"chat-input"},ae={class:"input-container"},ne={class:"field-container"},te={class:"input-buttons"},ie=n({__name:"index",setup(e){const n=t(),j=i(null),L=s(),ie=i(""),se=i(""),le=i(!0),oe=i("1"),ce=i([{text:"问数据",value:"1"},{text:"问法规",value:"2"}]),de=i(["我是工贸企业，要做哪些安全管理制度？","有限空间作业要办哪些票证、流程、防护？","电气/设备常见隐患有哪些？怎么自查整改？"]),ue=["我是工贸企业，要做哪些安全管理制度？","有限空间作业要办哪些票证、流程、防护？","电气/设备常见隐患有哪些？怎么自查整改？","危化品企业需要哪些安全管理制度和台账？","重大危险源怎么辨识、分级、建档、报备？","危化品泄漏、火灾、中毒应急处置步骤怎么做？","双重预防机制怎么建、资料怎么做？","发生事故/隐患，怎么上报、调查、闭环？","安全员日常要做哪些工作，不背锅、不违规？"];function re(){const e=[...ue].sort(()=>.5-Math.random());de.value=e.slice(0,3)}function ve(e){return e.startsWith("/")?new URL(`${e}`,window.location.origin).href:new URL(e,a.meta.url).href}function pe(e){oe.value=e}function me(){L.push({name:"chatPageVideo"})}function fe(){L.push({name:"orderService"})}const ge=i([{id:0,name:"智能体",icon:"iconyinhuanqingdan",url:"agentPerson"},{id:1,name:"隐患上报",icon:"iconshangbao1",url:"hazardReporting"},{id:2,name:"作业申请",icon:"iconyinhuanpaichajihua",url:"workRequest"},{id:3,name:"全部应用",icon:"iconxiangmuguanli",url:"/home/"}]),ye=i([]),he=i(!1);async function be(){if(1==he.value)return void H("数据正在生成中请稍后...");if(!se.value.trim())return;se.value&&(le.value=!1);const e={id:Date.now(),type:"user",content:se.value.trim(),time:Y(new Date).format("YYYY-MM-DD HH:mm:ss")};ye.value.push(e);const a=se.value.trim();se.value="";const n={id:Date.now()+1,type:"ai",content:"",displayContent:"",typingIndex:0,loading:!0,time:Y(new Date).format("YYYY-MM-DD HH:mm:ss")};ye.value.push(n);try{let e;"1"===oe.value?(he.value=!0,e=await V({answer:a})):(he.value=!0,e=await A({content:a})),function(e,a){const n=ye.value.find(a=>a.id===e&&"ai"===a.type);if(!n)return;n.displayContent=a,n.typingIndex=0;const t=5,i=100;setTimeout(()=>{const a=ye.value.find(a=>a.id===e&&"ai"===a.type);if(a){a.loading=!1;const n=setInterval(()=>{const a=ye.value.find(a=>a.id===e&&"ai"===a.type);if(!a)return clearInterval(n),void(he.value=!1);if(a.typingIndex>=a.displayContent.length)return clearInterval(n),void(he.value=!1);const i=Math.min(a.typingIndex+t,a.displayContent.length);a.typingIndex=i,a.content=a.displayContent.slice(0,i),R(()=>{j.value&&(j.value.scrollTop=j.value.scrollHeight)})},i)}else console.log("Current message not found:",e)},100)}(n.id,e)}catch(t){console.error("Error getting AI answer:",t);const e=ye.value.find(e=>e.id===n.id);e&&(e.loading=!1,e.content='<div style="color: #ff4d4f;">抱歉，获取AI回答失败，请重试</div>')}}function ke(){n?.userInfo?.etp_id_name||L.push({name:"login"})}return l(()=>{ie.value=n?.userInfo?.etp_id_name?n?.userInfo?.etp_id_name:"未登陆，请登录"}),(e,a)=>{const n=r,t=v,i=f,s=g,l=g,H=b,Y=k,V=x;return c(),o("div",T,[d(n,{title:ie.value,class:"nav-bar",onClick:ke},null,8,["title"]),le.value?(c(),o("div",U,[u("div",S,[u("div",q,[d(t,{src:ve("/static/common/images/ai/person.png"),round:"",class:"img"},null,8,["src"]),a[2]||(a[2]=u("div",{class:"message-text"},[u("p",{class:"greeting"}," 你好 "),u("p",{class:"recommendation"}," 您好！我是您的AI安全助手，为您推荐我的AI安全生产管理服务，可以帮您完成 “风险、隐患、作业” 所有安全事务 ")],-1))]),u("div",E,[u("div",P,[d(i,{type:"default",class:"btn-learn",onClick:me},{default:p(()=>[...a[3]||(a[3]=[m(" 了解DeepSafety ",-1)])]),_:1}),d(i,{type:"warning",class:"btn-order",onClick:fe},{default:p(()=>[...a[4]||(a[4]=[m(" 订购 ",-1)])]),_:1})])])]),u("div",z,[u("div",F,[a[6]||(a[6]=u("h3",{class:"guess-title"}," 猜你想问 ",-1)),u("div",{class:"refresh-btn",onClick:re},[d(s,{name:"replay"}),a[5]||(a[5]=m(" 换一换 ",-1))])]),u("div",G,[(c(!0),o(y,null,h(de.value,(e,a)=>(c(),o("div",{key:a,class:"guess-item",onClick:a=>function(e){se.value=e,be()}(e)},w(e),9,J))),128))])])])):(c(),o("div",{key:1,ref_key:"chatMessagesRef",ref:j,class:"chat-content-message"},[(c(!0),o(y,null,h(ye.value,e=>(c(),o("div",{key:e.id||e.time,class:C(["dialogue-item","user"===e.type?"user-dialogue":"ai-dialogue"])},[u("div",{class:C(["dialogue-avatar","user"===e.type?"user-avatar":"ai-avatar"])},["user"===e.type?(c(),_(t,{key:0,src:ve("/static/common/images/ai/man.png"),round:"",class:"h-40 w-40"},null,8,["src"])):(c(),_(t,{key:1,src:ve("/static/common/images/ai/ai.png"),round:"",class:"h-40 w-40"},null,8,["src"]))],2),u("div",{class:C(["dialogue-content","user"===e.type?"user-content":"ai-content"])},[u("div",{class:C(["dialogue-bubble","user"===e.type?"user-bubble":"ai-bubble"])},["ai"===e.type&&e.loading?(c(),o("div",K,[...a[7]||(a[7]=[M('<div class="colorful-loader" data-v-7ffbd240><div class="loader-dot" data-v-7ffbd240></div><div class="loader-dot" data-v-7ffbd240></div><div class="loader-dot" data-v-7ffbd240></div><div class="loader-dot" data-v-7ffbd240></div><div class="loader-dot" data-v-7ffbd240></div></div><div class="loading-text" data-v-7ffbd240> AI 正在思考... </div>',2)])])):"ai"===e.type?(c(),o("div",{key:1,innerHTML:e.content},null,8,W)):"user"===e.type?(c(),o("div",$,w(e.content),1)):D("",!0),u("div",B,[u("span",{class:C({"dialogue-time-ai":"ai"===e.type,"dialogue-time-user":"user"===e.type})},w(e.time),3),"ai"===e.type?(c(),o("span",{key:0,class:C({"dialogue-tips-ai":"ai"===e.type,"dialogue-tips-user":"user"===e.type})},"此内容由AI生成",2)):D("",!0)])],2)],2)],2))),128))],512)),u("div",N,[u("div",O,[(c(!0),o(y,null,h(ge.value,e=>(c(),o("div",{key:e.id,class:"nav-item",onClick:a=>function(e){L.push({name:e.url})}(e)},[u("div",X,[d(l,{"class-prefix":e.icon,class:"iconfont menu-icon",name:"extra"},null,8,["class-prefix"])]),u("span",Z,w(e.name),1)],8,Q))),128))])]),u("div",ee,[u("div",ae,[d(Y,{class:"ai-type-selector",style:{"background-color":"transparent !important"},background:"transparent",direction:"up"},{default:p(()=>[d(H,{modelValue:oe.value,"onUpdate:modelValue":a[0]||(a[0]=e=>oe.value=e),options:ce.value,onChange:pe},null,8,["modelValue","options"])]),_:1}),u("div",ne,[d(V,{modelValue:se.value,"onUpdate:modelValue":a[1]||(a[1]=e=>se.value=e),placeholder:"发消息...",class:"input-field",onKeyup:I(be,["enter"])},null,8,["modelValue"])]),u("div",te,[d(s,{name:"guide-o",class:"guide-btn",onClick:be})])])])])}}});"function"==typeof L&&L(ie),e("default",j(ie,[["__scopeId","data-v-7ffbd240"]]))}}});
