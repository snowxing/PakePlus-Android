import{g as G,a as H,b as K,c as W,d as X,e as Z}from"./information-CGEsnMWk.js";import{d as k,j as I,r as d,o as N,O as ee,a0 as le,x as ae,g as V,a as _,h as o,v as O,k as oe,c as y,_ as ne,m as c,i as $,C as te,D as ue,G as se,$ as de,a1 as re,B as me,H as ie,J as ve,a2 as pe,L as _e,M as q,y as S,b as x,e as Y}from"./index-5kp1FiRg.js";import{_ as fe}from"./SearchForm.vue_vue_type_script_setup_true_lang-CeXXaBgy.js";import{u as be}from"./useTabsListener-CnvSNM1v.js";const ce={class:"tree-container"},Ve={key:0,class:"empty-state"},ge={key:1,style:{height:"calc(100vh - 60px)"}},ye=k({__name:"OrgStructure",setup(U){const i=I(),s=d(null),l=d(!1);async function f(){var v,u;try{const{pid:r,etp_id:p}=i.userInfo;l.value=!0;const m=await G({id:"SELF0",deep:3,base:1,is_node:r!=="0"?1:0});l.value=!1,console.log("API响应数据:",m),m&&m.length?(s.value={id:(v=m[0])==null?void 0:v.parent_id,title:(u=m[0])==null?void 0:u.etp_id_name,child:m.map(j=>({...j,_expanded:!1}))},console.log(s.value)):s.value=null}catch(r){console.error("获取数据失败:",r),s.value=null}}N(()=>{f()});const b={id:"id",pid:"parent_id",label:"title",children:"child"};return(v,u)=>{const r=ee("vue3-tree-org"),p=le("loading");return ae((_(),V("div",ce,[s.value?(_(),V("div",ge,[o(r,{disabled:!0,draggable:"",center:"","node-draggable":!1,data:s.value,props:b,collapsable:!0,horizontal:!1,scalable:!0,"expand-all":"true","default-expand-level":3},null,8,["data"])])):(_(),V("div",Ve," 暂无数据 "))])),[[p,l.value]])}}}),ke=O(ye,[["__scopeId","data-v-d6be4f5f"]]),Ue=k({__name:"QualiCertAndLicenses",setup(U){const{routerPush:i}=oe(),s=d({name:"",authority:"",set_etp_id:""}),l=[{icon:"search",key:"search"}];async function f({pageNum:u}){const r=await H({page:u,page_size:30,...s.value});return{total:Number(r.count),data:r.data}}const b=[{title:"名称",key:"name",width:"35%"},{title:"颁发机构",key:"authority",width:"30%"},{title:"到期日",key:"expire_date",width:"25%"}],v=u=>{const r=[{value:u.name,label:"名称"},{value:u.authority,label:"颁发机构"},{value:u.issue_date,label:"颁发日期"},{value:u.certificate_level,label:"证书等级"},{value:u.certificate_object,label:"持证对象"},{value:u.object_type,label:"对象类型"},{value:u.expire_date,label:"到期日"},{value:u.department,label:"责任部门"},{value:u.principal,label:"责任人"},{value:u.note,label:"备注"},{value:u.files,label:"证书",renderType:"image"}];i("basicDetail",{detail:JSON.stringify(r)})};return(u,r)=>{const p=ne;return _(),y(p,{columns:b,request:f,form:s.value,"onUpdate:form":r[1]||(r[1]=m=>s.value=m),floating:l,onOnRowClick:v},{searchForm:c(()=>[o(fe,{form:s.value,"onUpdate:form":r[0]||(r[0]=m=>s.value=m)},null,8,["form"])]),_:1},8,["form"])}}}),je={class:"form-container"},we={class:"form-content"},Se={class:"modern-floating-btn"},xe=k({__name:"Information",setup(U){const i=I(),s=d(),l=d({name:"",credit_code:"",sort_obj:{name:"",id:""},nature_obj:{name:"",id:""},scale_obj:{name:"",id:""},competent_unit:"",group:"",legal_person:"",post:"",founded:"",covered_area:"",staff_number:"",contact:"",tel:"",postal:"",city_obj:{name:""},address:"",map:{x:"",y:""},main_business:"",note:"",process:"",rank_obj:{name:"",id:""},safety_manager:"",phone:"",awh_name:"",awh_found_date:"",annual_value:"",department_name:"",found_date:"",manage_num:"",engineers_num:"",safe_obj:{name:"",id:""}}),f=d(!1),b=d(!1);d(!1),d(!1),d(!1);const v=d(!1),u=d(!1),r=d(!1),p=d([{name:"国企",value:"1"},{name:"外企",value:"2"},{name:"私企",value:"3"},{name:"合资",value:"4"}]),m=d([{name:"小型",value:"1"},{name:"中型",value:"2"},{name:"大型",value:"3"},{name:"微型",value:"4"}]),j=d([{name:"集团",value:"t0"},{name:"一级子公司",value:"t1"},{name:"二级子公司",value:"t2"}]),M=d([{name:"危险化工工艺",value:"1"},{name:"涉尘涉爆",value:"2"},{name:"重大危险源",value:"3"},{name:"有限(受限空间)",value:"4"}]);async function z(){try{const{etp_id:n}=i.userInfo,e=await K({id:n});console.log("API返回数据:",e),e&&e.name&&(l.value={...l.value,...e,sort_obj:e.sort_obj||{name:"",id:""},nature_obj:e.nature_obj||{name:"",id:""},scale_obj:e.scale_obj||{name:"",id:""},city_obj:e.city_obj||{name:""},rank_obj:e.rank_obj||{name:"",id:""},safe_obj:e.safe_obj||{name:"",id:""},map:{x:e.map_corrdinate?JSON.parse(e.map_corrdinate).x:"",y:e.map_corrdinate?JSON.parse(e.map_corrdinate).y:""}})}catch(n){console.error("获取企业数据失败:",n)}}const L=()=>{W({is_node:0,id:22,deep:1,enbase:1}).then(n=>{n&&n.length&&(p.value=n.map(e=>({name:e.title,value:e.node_id})))}),X({c:0}).then(n=>{n&&n.length&&(l.value.city_obj={name:n[0].name})})},B=n=>{l.value.nature_obj={name:n.name,id:n.value},f.value=!1},E=n=>{l.value.scale_obj={name:n.name,id:n.value},b.value=!1},R=n=>{l.value.rank_obj={name:n.name,id:n.value},v.value=!1},A=n=>{l.value.safe_obj={name:n.name,id:n.value},u.value=!1},F=async()=>{try{await s.value.validate(),Z(l.value).then(()=>{_e("保存成功")}).catch(n=>{q(n.message||"保存失败")})}catch(n){q(n[0].message||"表单验证失败"),console.log("表单验证失败",n)}};return N(()=>{z(),L()}),(n,e)=>{const h=te,D=ue,t=se,T=de,g=re,w=me,J=ie,P=pe;return _(),V("div",je,[o(D,null,{default:c(()=>[o(h,{title:"基本信息",class:"h5-title"})]),_:1}),$("div",we,[o(P,{"show-error-message":!1,ref_key:"formRef",ref:s},{default:c(()=>[o(t,{modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.name=a),label:"企业名称",placeholder:"请输入",required:"",rules:[{required:!0,message:"请输入企业名称"}]},null,8,["modelValue"]),o(t,{modelValue:l.value.credit_code,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.credit_code=a),label:"信用代码",placeholder:"请输入",required:"",rules:[{required:!0,message:"请输入信用代码"}]},null,8,["modelValue"]),o(T,{"model-value":l.value.sort_obj.id,options:p.value,"field-names":{label:"name",value:"value"},label:"所属行业",placeholder:"请选择所属行业","onUpdate:modelValue":e[2]||(e[2]=a=>{var C;return l.value.sort_obj={id:a,name:((C=p.value.find(Q=>Q.value===a))==null?void 0:C.name)||""}})},null,8,["model-value","options"]),o(t,{modelValue:l.value.address,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.address=a),label:"企业地址",placeholder:"请输入"},null,8,["modelValue"]),o(t,{modelValue:l.value.nature_obj.name,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.nature_obj.name=a),label:"企业性质",placeholder:"请选择","is-link":"",readonly:"",onClick:e[5]||(e[5]=a=>f.value=!0)},null,8,["modelValue"]),o(g,{show:f.value,"onUpdate:show":e[6]||(e[6]=a=>f.value=a),actions:p.value,onSelect:B},null,8,["show","actions"]),o(t,{modelValue:l.value.scale_obj.name,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.scale_obj.name=a),label:"公司规模",placeholder:"请选择","is-link":"",readonly:"",onClick:e[8]||(e[8]=a=>b.value=!0)},null,8,["modelValue"]),o(g,{show:b.value,"onUpdate:show":e[9]||(e[9]=a=>b.value=a),actions:m.value,onSelect:E},null,8,["show","actions"]),o(t,{modelValue:l.value.competent_unit,"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.competent_unit=a),label:"主管单位",placeholder:"请输入"},null,8,["modelValue"]),o(t,{modelValue:l.value.group,"onUpdate:modelValue":e[11]||(e[11]=a=>l.value.group=a),label:"所属集团",placeholder:"请输入"},null,8,["modelValue"]),o(t,{modelValue:l.value.legal_person,"onUpdate:modelValue":e[12]||(e[12]=a=>l.value.legal_person=a),label:"法定代表人",placeholder:"请输入"},null,8,["modelValue"]),o(t,{modelValue:l.value.post,"onUpdate:modelValue":e[13]||(e[13]=a=>l.value.post=a),label:"总经理",placeholder:"请输入"},null,8,["modelValue"]),o(w,{"model-value":l.value.founded,format:"YYYY-MM-DD",label:"成立时间",placeholder:"请选择","onUpdate:modelValue":e[14]||(e[14]=a=>a&&(l.value.founded=a))},null,8,["model-value"]),o(t,{modelValue:l.value.annual_value,"onUpdate:modelValue":e[15]||(e[15]=a=>l.value.annual_value=a),label:"年产值",placeholder:"请输入"},null,8,["modelValue"]),o(t,{modelValue:l.value.staff_number,"onUpdate:modelValue":e[16]||(e[16]=a=>l.value.staff_number=a),label:"员工人数",placeholder:"请输入",required:"",rules:[{required:!0,message:"请输入员工人数"}]},null,8,["modelValue"]),o(t,{modelValue:l.value.covered_area,"onUpdate:modelValue":e[17]||(e[17]=a=>l.value.covered_area=a),label:"占地面积",placeholder:"请输入"},null,8,["modelValue"]),o(t,{modelValue:l.value.contact,"onUpdate:modelValue":e[18]||(e[18]=a=>l.value.contact=a),label:"联系人",placeholder:"请输入"},null,8,["modelValue"]),o(t,{modelValue:l.value.tel,"onUpdate:modelValue":e[19]||(e[19]=a=>l.value.tel=a),label:"联系方式",placeholder:"请输入"},null,8,["modelValue"]),o(t,{modelValue:l.value.postal,"onUpdate:modelValue":e[20]||(e[20]=a=>l.value.postal=a),label:"邮政编码",placeholder:"请输入",required:"",rules:[{required:!0,message:"请输入邮政编码"}]},null,8,["modelValue"]),o(t,{modelValue:l.value.city_obj.name,"onUpdate:modelValue":e[21]||(e[21]=a=>l.value.city_obj.name=a),label:"行政区",placeholder:"请选择","is-link":"",readonly:"",onClick:e[22]||(e[22]=a=>r.value=!0)},null,8,["modelValue"]),o(t,{modelValue:l.value.address,"onUpdate:modelValue":e[23]||(e[23]=a=>l.value.address=a),label:"详细地址",placeholder:"请输入",type:"textarea",autosize:""},null,8,["modelValue"]),o(t,{"model-value":l.value.map.x&&l.value.map.y?"".concat(l.value.map.x,",").concat(l.value.map.y):"",label:"地理坐标",placeholder:"暂无坐标",disabled:""},null,8,["model-value"]),o(t,{modelValue:l.value.main_business,"onUpdate:modelValue":e[24]||(e[24]=a=>l.value.main_business=a),label:"主营业务",placeholder:"请输入",type:"textarea",autosize:""},null,8,["modelValue"]),o(t,{modelValue:l.value.note,"onUpdate:modelValue":e[25]||(e[25]=a=>l.value.note=a),label:"公司简介",placeholder:"请输入",type:"textarea",autosize:""},null,8,["modelValue"]),o(t,{modelValue:l.value.process,"onUpdate:modelValue":e[26]||(e[26]=a=>l.value.process=a),label:"生产工艺",placeholder:"请输入",type:"textarea",autosize:""},null,8,["modelValue"]),o(t,{modelValue:l.value.rank_obj.name,"onUpdate:modelValue":e[27]||(e[27]=a=>l.value.rank_obj.name=a),label:"公司级别",placeholder:"请选择","is-link":"",readonly:"",onClick:e[28]||(e[28]=a=>v.value=!0)},null,8,["modelValue"]),o(g,{show:v.value,"onUpdate:show":e[29]||(e[29]=a=>v.value=a),actions:j.value,onSelect:R},null,8,["show","actions"]),o(D,null,{default:c(()=>[o(h,{title:"安全信息",class:"h5-title"})]),_:1}),o(t,{modelValue:l.value.safety_manager,"onUpdate:modelValue":e[30]||(e[30]=a=>l.value.safety_manager=a),label:"安全负责人",placeholder:"请输入",required:"",rules:[{required:!0,message:"请输入安全负责人"}]},null,8,["modelValue"]),o(t,{modelValue:l.value.phone,"onUpdate:modelValue":e[31]||(e[31]=a=>l.value.phone=a),label:"联系方式",placeholder:"请输入",required:"",rules:[{required:!0,message:"请输入联系方式"}]},null,8,["modelValue"]),o(t,{modelValue:l.value.awh_name,"onUpdate:modelValue":e[32]||(e[32]=a=>l.value.awh_name=a),label:"安委会名称",placeholder:"请输入",required:"",rules:[{required:!0,message:"请输入安委会名称"}]},null,8,["modelValue"]),o(w,{"model-value":l.value.awh_found_date,format:"YYYY-MM-DD",label:"成立时间",placeholder:"请选择","onUpdate:modelValue":e[33]||(e[33]=a=>a&&(l.value.awh_found_date=a))},null,8,["model-value"]),o(t,{modelValue:l.value.department_name,"onUpdate:modelValue":e[34]||(e[34]=a=>l.value.department_name=a),label:"安全机构名称",placeholder:"请输入",required:"",rules:[{required:!0,message:"请输入安全机构名称"}]},null,8,["modelValue"]),o(w,{"model-value":l.value.found_date,format:"YYYY-MM-DD",label:"成立时间",placeholder:"请选择","onUpdate:modelValue":e[35]||(e[35]=a=>a&&(l.value.found_date=a))},null,8,["model-value"]),o(t,{modelValue:l.value.manage_num,"onUpdate:modelValue":e[36]||(e[36]=a=>l.value.manage_num=a),label:"安全管理人数",placeholder:"请输入"},null,8,["modelValue"]),o(t,{modelValue:l.value.engineers_num,"onUpdate:modelValue":e[37]||(e[37]=a=>l.value.engineers_num=a),label:"注安人数",placeholder:"请输入"},null,8,["modelValue"]),o(t,{modelValue:l.value.safe_obj.name,"onUpdate:modelValue":e[38]||(e[38]=a=>l.value.safe_obj.name=a),label:"风险标签",placeholder:"请选择","is-link":"",readonly:"",onClick:e[39]||(e[39]=a=>u.value=!0)},null,8,["modelValue"]),o(g,{show:u.value,"onUpdate:show":e[40]||(e[40]=a=>u.value=a),actions:M.value,onSelect:A},null,8,["show","actions"]),$("div",Se,[o(J,{type:"primary",round:"",size:"large",onClick:F,class:"modern-save-btn"},{default:c(()=>[...e[41]||(e[41]=[ve(" 保存 ",-1)])]),_:1})])]),_:1},512)])])}}}),he=O(xe,[["__scopeId","data-v-38942393"]]),De={class:"flex-center w-100% items-center"},Ce=k({__name:"index",setup(U){const i=d("OrgStructure");return be("information-click-tab",s=>{i.value=s.name}),(s,l)=>(_(),V("div",De,[x(i)==="OrgStructure"?(_(),y(ke,{key:0})):S("",!0),x(i)==="QualiCertAndLicenses"?(_(),y(Ue,{key:1})):S("",!0),x(i)==="Information"?(_(),y(he,{key:2})):S("",!0)]))}});typeof Y=="function"&&Y(Ce);export{Ce as default};
