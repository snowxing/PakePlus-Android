import{aB as D,v as F,j as L,r as o,o as S,g as p,a as _,i as d,h as u,m as f,H as j,J as H,F as J,E as R,ad as b,aq as T,a_ as A,e as P}from"./index-5kp1FiRg.js";const G=h=>D.get("/ensafe/map_risk_list",{params:h}),K={class:"riskmap-container"},O={class:"map-container"},Q=["src"],W={class:"popup-header"},X={class:"popup-content"},Y={class:"info-title"},Z={class:"info-value"},B={__name:"index",setup(h){var $;const c=($=L())==null?void 0:$.userInfo,v=o(!1),g=o(""),k=o(0),w=o(0),I=o([]),r=o([0,0]),x=o([]);o([]);const E=o([]),y=o(""),m=o(!1),i=[{id:0,name:"隐患",level:[{id:0,name:"全部"},{id:1,name:"重大"},{id:2,name:"较大"},{id:3,name:"一般"},{id:4,name:"低"}]},{id:1,name:"风险源",level:[{id:0,name:"全部"},{id:1,name:"重大"},{id:2,name:"较大"},{id:3,name:"一般"},{id:4,name:"低"}]},{id:2,name:"应急物资",level:[{id:0,name:"全部"},{id:1,name:"重大"},{id:2,name:"较大"},{id:3,name:"一般"},{id:4,name:"低"}]},{id:3,name:"许可作业",level:[{id:0,name:"全部"},{id:1,name:"重大"},{id:2,name:"较大"},{id:3,name:"一般"},{id:4,name:"低"}]},{id:4,name:"特殊设备",level:[{id:0,name:"全部"},{id:1,name:"重大"},{id:2,name:"较大"},{id:3,name:"一般"},{id:4,name:"低"}]},{id:5,name:"监控报警",level:[{id:0,name:"全部"},{id:1,name:"重大"},{id:2,name:"较大"},{id:3,name:"一般"},{id:4,name:"低"}]}];S(()=>{const a="http://z.saveus.cn";y.value="".concat(a,"/web/iframe/riskmap?type=1&level=0&x=").concat(c.map.x,"&y=").concat(c.map.y,"&eid=").concat(c.eid,"&etp_id=").concat(c.etp_id),V()});const V=()=>{const a=[],e=[];i.forEach(t=>{a.push({text:t.name,value:t.id}),e.length===0&&t.level.forEach(n=>{e.push({text:n.name,value:n.id})})}),x.value=[{values:a},{values:e}],r.value=[0,0];const s="".concat(i[0].name,"-").concat(i[0].level[0].name);g.value=s,C()},C=async()=>{var t;const a=i[r.value[0]],e=a.id,s=a.level[r.value[1]].id;try{const n=await G({type:e,level:s,category:0}),l=((t=n==null?void 0:n.map_config)==null?void 0:t.map_corrdinate)||{};k.value=l.x,w.value=l.y,I.value=[M(0,s,k.value,w.value,!0)]}catch(n){console.error("加载地图数据失败:",n)}},M=(a,e,s,t,n=!0)=>({iconPath:"/static/common/images/mark3.png",id:a,latitude:t,longitude:s,width:50,height:50}),N=()=>{v.value=!1},U=(a,e)=>{const s="".concat(i[e[0]].text,"-").concat(i[e[0]].level[e[1]].text);g.value=s,r.value=e,m.value=!1,C()},q=(a,e,s)=>{if(s===0){const t=i[e[0]].level.map(n=>({text:n.name,value:n.id}));a.setColumnValues(1,t),a.setIndexes([e[0],0])}};return(a,e)=>{const s=j,t=T,n=A;return _(),p("div",K,[d("div",O,[d("iframe",{frameborder:"no",border:"0",marginwidth:"0",marginheight:"0",scrolling:"no",allowtransparency:"yes",src:y.value,class:"map-iframe"},null,8,Q)]),u(t,{show:v.value,"onUpdate:show":e[0]||(e[0]=l=>v.value=l),position:"center",round:"",style:{width:"80%",padding:"20px"}},{default:f(()=>[d("div",W,[e[4]||(e[4]=d("h3",null,"详情",-1)),u(s,{size:"small",onClick:N},{default:f(()=>[...e[3]||(e[3]=[H("关闭",-1)])]),_:1})]),d("div",X,[(_(!0),p(J,null,R(E.value,(l,z)=>(_(),p("div",{key:z,class:"info-row"},[d("span",Y,b(l.title),1),d("span",Z,b(l.value),1)]))),128))])]),_:1},8,["show"]),u(t,{show:m.value,"onUpdate:show":e[2]||(e[2]=l=>m.value=l),position:"bottom"},{default:f(()=>[u(n,{columns:x.value,onConfirm:U,onCancel:e[1]||(e[1]=l=>m.value=!1),onChange:q},null,8,["columns"])]),_:1},8,["show"])])}}};typeof P=="function"&&P(B);const ae=F(B,[["__scopeId","data-v-d276d64c"]]);export{ae as default};
